<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen" />

<script type="text/javascript" src="js/jquery.js"></script> 
<script type="text/javascript" src="js/eventemitter2.js"></script> 
<script type="text/javascript" src="js/roslib.js"></script> 
<script type="text/javascript" src="js/jquery.flexslider.js"></script>
<script type="text/javascript" type="text/javascript">
    var ros = new ROSLIB.Ros();

    /*setting info publish topic name*/
    var motion_pub_topic = "/motion_player/motion_playback";
    
    /*setting info publish topic type*/
    var motion_pub_topic_type = "motion_retargeting_msgs/MotionPlayback";
    
    /*setting info subscriber topic name*/
    var response_sub_topic = "/response";
    var motion_response_sub_topic = "/motion_player/playback_status";
    
    /*setting info publish topic type*/
    var response_sub_topic_type = "std_msgs/String";
    var motion_response_sub_topic_type = "motion_retargeting_msgs/PlaybackStatus";
    
    /*setting info subscriber topic type*/
    var response_listener;
    var motion_publisher;
    
    
    /*setting info*/
    var defaultUrL = "ws://"+"localhost"+":9090";
    $().ready(function(e){
      $('.sta-ros-connect').click(function(){
            var robot_url = $(".sta-robot-ip").val();
            defaultUrL = "ws://"+robot_url+":9090";
            console.log("Ros connect: "+defaultUrL);
            settingROSCallbacks();
            ros.connect(defaultUrL);
       });
    });
   
 
    
    function settingROSCallbacks(){    
      ros.on('connection',function(){
          console.log("ROS Connected");
           $('.sta-ros-connect').val('Connecting...').attr("disabled", "disabled");
           setup_pub_sub();

      });
      ros.on('error',function(e) {
        console.log("ROS Error!",e);
      });
      ros.on('close',function() {
        console.log("ROS onnection Close!");
      });
    }
    
    function setup_pub_sub() {
      /*subscriber*/
      namespace = $('.sta-namesapce').val();
      motion_response_sub_topic = namespace + motion_response_sub_topic
      console.log("motion_response_sub_topic: ", motion_response_sub_topic);
      motion_response_listener = new ROSLIB.Topic({
            ros : ros,
            name : motion_response_sub_topic,
            messageType: motion_response_sub_topic_type
            });    
      motion_response_listener.subscribe(function(msg){console.log("motion_response_listener: ", msg);});
      
      /*publisher*/
      
      motion_pub_topic = namespace + motion_pub_topic;
      console.log("motion_pub_topic: ", motion_pub_topic);
      motion_publisher = new ROSLIB.Topic({
        ros : ros,
        name : motion_pub_topic,
        messageType: motion_pub_topic_type
      });
    }
    
   function response_listen(msg) {
     if (msg.data.indexOf("tts_response")!== -1){
       tts_res_flag = true;
     }
     else if (msg.data.indexOf("face_response")!== -1){
       face_res_flag = true;
     }
     else{
       console.log("receive Unknown response");
     }
  };
  
  $(window).load(function(){
    $('.sta-play').click(function(){
      console.log($('.sta-motion-name').val());
      var motion_type = $('.sta-motion-name').val();
      var init_motion = new ROSLIB.Message({
            start_playback: true,
            motion_name: motion_type
            });
        motion_publisher.publish(init_motion);
    });

    });
  
</script>
</head>
</html>

<html>
</body>
<h1>Motion list</h1>
   <li>  robosem_motion_all_this</li>
   <li>  robosem_motion_you_out</li>
   <li>  robosem_motion_no</li>
   <li>  robosem_motion_bum_touching</li>
   <li>  robosem_motion_flying</li>
   <li>  robosem_motion_crazy_egyptian</li>
   <li>  robosem_motion_korean_bowing</li>
   <li>  robosem_motion_yes</li>
   <li>  robosem_motion_hello</li>
   <li>  robosem_motion_lala</li>
   <li>  robosem_motion_scared</li>

<h1>prototype TEST</h1>

<label>NameSpace: </label>
<input class="sta-namesapce" type="text" placeholder='Namespace here' value = "/rocon_robosem">
</p>

<label>Robot IP: </label>
<input class="sta-robot-ip" type="text" placeholder='Robot ip here' value = "localhost">
<input class="sta-ros-connect" type="button" value = "Connect"/></p>
</p>

<label>Motion: </label>
<input class="sta-motion-name" type="text" placeholder='Motion here' value = "">
<input class="sta-play" type="button" value = "Play"/></p>
<h1>Log here</h1>
<div class='sta-log'></div>
</body>
</html>

